# NVIDIA GPU Operator for RTX 5080 with Time-Slicing
# Chart: nvidia/gpu-operator
# Version: 25.10.x
# Target Hardware: RTX 5080 (16GB GDDR7 VRAM, Blackwell architecture)
#
# Configuration Rationale:
# - Driver installation enabled for RTX 5080 compatibility
# - Time-slicing enabled to share GPU across multiple workloads
# - MIG disabled (not supported on RTX 5080)
# - Containerd runtime configured for k3s compatibility

driver:
  enabled: true  # Required for RTX 5080 - installs NVIDIA drivers on host

toolkit:
  enabled: true
  env:
    - name: CONTAINERD_CONFIG
      value: /var/lib/rancher/k3s/agent/etc/containerd/config.toml
    - name: CONTAINERD_SOCKET
      value: /run/k3s/containerd/containerd.sock

devicePlugin:
  enabled: true

dcgmExporter:
  enabled: true

gfd:
  enabled: true

migManager:
  enabled: false  # RTX 5080 does not support MIG (Multi-Instance GPU)

validator:
  enabled: true
  env:
    - name: WITH_WORKLOAD
      value: "true"

cdi:
  enabled: true
  default: true

# Time-slicing configuration for 4 virtual GPUs
operator:
  defaultRuntime: containerd

# Time-slicing ConfigMap
timeSlicing:
  enabled: true  # Enables GPU sharing across multiple containers
  config:
    rtx-5080: |-
      version: v1
      flags:
        migStrategy: none  # MIG not supported on RTX 5080
      sharing:
        timeSlicing:
          renameByDefault: false
          failRequestsGreaterThanOne: false
          resources:
            - name: nvidia.com/gpu
              replicas: 4  # Creates 4 virtual GPUs from single RTX 5080
