# Default values for LiteLLM proxy
# GPU inference queue with Ollama backend

replicaCount: 1

image:
  repository: ghcr.io/berriai/litellm
  tag: v1.80.11-stable
  pullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: "litellm"

# Database configuration - disabled by default due to Prisma issues
database:
  enabled: false

service:
  type: ClusterIP
  port: 4000
  metricsPort: 9090

ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    cert-manager.io/cluster-issuer: letsencrypt-production
  hosts:
    - host: llm.vectorweight.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - llm.vectorweight.com
      secretName: vectorweight-wildcard-tls

# Environment variables
env:
  OLLAMA_GPU_URL: "http://ollama-gpu.gpu-workloads:11434"
  OLLAMA_CPU_URL: "http://ollama.ai-services:11434"
  REDIS_HOST: "redis-master.ai-services"
  REDIS_PORT: "6379"
  # Prisma cache directory (must be writable)
  PRISMA_HOME: "/tmp/prisma"
  HOME: "/tmp"
  # Disable store_model_in_db to avoid Prisma query engine issues
  STORE_MODEL_IN_DB: "false"
  DISABLE_SPEND_LOGS: "true"

# Secret references
secrets:
  litellmMasterKey:
    secretName: litellm-secret
    key: master-key
  databaseUrl:
    secretName: litellm-secret
    key: database-url

# Config file mount
config:
  enabled: true
  configMapName: litellm-config
  mountPath: /app/config.yaml
  subPath: config.yaml

# Resource allocation - sufficient for handling concurrent requests
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2000m
    memory: 4Gi

# Health checks
livenessProbe:
  httpGet:
    path: /health/liveliness
    port: 4000
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 10

readinessProbe:
  httpGet:
    path: /health/readiness
    port: 4000
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 5

# Pod configuration
nodeSelector: {}

tolerations: []

affinity: {}

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod security context
podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
