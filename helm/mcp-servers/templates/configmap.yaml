apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mcp-servers.fullname" . }}-config
  labels:
    {{- include "mcp-servers.labels" . | nindent 4 }}
data:
  # MCPO configuration for enabled MCP servers
  mcpo-config.json: |
    {
      "mcpServers": {
        {{- $first := true }}
        {{- if .Values.servers.filesystem.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "filesystem": {
          "description": {{ .Values.servers.filesystem.description | quote }},
          "command": "npx",
          "args": ["-y", {{ .Values.servers.filesystem.package | quote }}, {{- range .Values.servers.filesystem.allowedPaths }}{{ . | quote }},{{- end }}""]
        }
        {{- end }}
        {{- if .Values.servers.git.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "git": {
          "description": {{ .Values.servers.git.description | quote }},
          "command": "npx",
          "args": ["-y", {{ .Values.servers.git.package | quote }}]
        }
        {{- end }}
        {{- if .Values.servers.fetch.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "fetch": {
          "description": {{ .Values.servers.fetch.description | quote }},
          "command": "npx",
          "args": ["-y", {{ .Values.servers.fetch.package | quote }}]
        }
        {{- end }}
        {{- if .Values.servers.memory.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "memory": {
          "description": {{ .Values.servers.memory.description | quote }},
          "command": "npx",
          "args": ["-y", {{ .Values.servers.memory.package | quote }}]
        }
        {{- end }}
        {{- if .Values.servers.time.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "time": {
          "description": {{ .Values.servers.time.description | quote }},
          "command": "uvx",
          "args": [{{ .Values.servers.time.package | quote }}]
        }
        {{- end }}
        {{- if .Values.servers.duckduckgo.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "duckduckgo": {
          "description": {{ .Values.servers.duckduckgo.description | quote }},
          "command": "uvx",
          "args": [{{ .Values.servers.duckduckgo.package | quote }}]
        }
        {{- end }}
        {{- if .Values.servers.sequentialThinking.enabled }}
        {{- if not $first }},{{ end }}{{- $first = false }}
        "sequential-thinking": {
          "description": {{ .Values.servers.sequentialThinking.description | quote }},
          "command": "npx",
          "args": ["-y", {{ .Values.servers.sequentialThinking.package | quote }}]
        }
        {{- end }}
      }
    }
